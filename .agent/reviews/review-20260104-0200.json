{
  "timestamp": "2026-01-04T02:00:59.377313",
  "project": "family-budget",
  "commit": "151f13d2c8a17c7314555247937223175a450a35",
  "previous_commit": "28cc98b48e08157aa066b9a9df1ff77e371e2ecd",
  "files_reviewed": 3,
  "summary": {
    "total_issues": 17,
    "auto_fixable": 5,
    "by_severity": {
      "error": 5,
      "warning": 10,
      "info": 2
    },
    "by_category": {
      "security": 6,
      "unused": 1,
      "performance": 3,
      "style": 2,
      "error_handling": 2,
      "bug": 3
    }
  },
  "issues": [
    {
      "line": 9,
      "severity": "warning",
      "category": "security",
      "message": "Inkludering af database-mapper ('data/') i critical_paths \u00f8ger risikoen for, at f\u00f8lsomme sqlite- eller db-filer utilsigtet inkluderes i backups, container-images eller deployment-pakker.",
      "auto_fixable": false,
      "file": "family-budget/.agent/manifest.yaml"
    },
    {
      "line": 17,
      "severity": "error",
      "category": "security",
      "message": "Manglende versions-pinning p\u00e5 dependencies (f.eks. fastapi>=0.100.0) kan f\u00f8re til ikke-deterministiske builds og s\u00e5rbarhed overfor 'supply-chain' angreb eller 'breaking changes'.",
      "auto_fixable": false,
      "file": "family-budget/.agent/manifest.yaml"
    },
    {
      "line": 10,
      "severity": "info",
      "category": "unused",
      "message": "Ubrugt import 'os'.",
      "auto_fixable": true,
      "fix": {
        "old": "import os",
        "new": ""
      },
      "file": "family-budget/src/api.py"
    },
    {
      "line": 31,
      "severity": "warning",
      "category": "performance",
      "message": "Memory leak i RateLimitMiddleware: 'self.attempts' rydder op i tidsstempler, men fjerner aldrig IP-n\u00f8glerne fra dictionary, hvilket vil f\u00e5 hukommelsesforbruget til at vokse over tid.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 80,
      "severity": "info",
      "category": "style",
      "message": "Inline import af 'logging'. Modulet b\u00f8r importeres \u00f8verst i filen for at f\u00f8lge PEP8 og undg\u00e5 redundant overhead ved gentagne funktionskald.",
      "auto_fixable": true,
      "fix": {
        "old": "            import logging",
        "new": ""
      },
      "file": "family-budget/src/api.py"
    },
    {
      "line": 95,
      "severity": "error",
      "category": "performance",
      "message": "Race condition og performance problem: Hele sessions-filen l\u00e6ses og overskrives ved hvert login/logout uden fil-l\u00e5sning. Ved flere samtidige brugere risikeres tab af sessionsdata.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 131,
      "severity": "warning",
      "category": "security",
      "message": "Hardcoded 'DEMO_SESSION_ID'. Dette g\u00f8r det nemt at g\u00e6tte en gyldig session-cookie. B\u00f8r genereres eller hentes fra milj\u00f8variabler.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 226,
      "severity": "warning",
      "category": "security",
      "message": "Inkonsekvent cookie-sikkerhed: Demo-mode cookie mangler 'secure=True', hvilket g\u00f8r den s\u00e5rbar overfor interception p\u00e5 HTTP, i mods\u00e6tning til den rigtige login-cookie.",
      "auto_fixable": true,
      "fix": {
        "old": "        httponly=True,\n        samesite=\"lax\",",
        "new": "        httponly=True,\n        secure=True,\n        samesite=\"lax\","
      },
      "file": "family-budget/src/api.py"
    },
    {
      "line": 300,
      "severity": "error",
      "category": "error_handling",
      "message": "Manglende fejlh\u00e5ndtering ved database-kald (fx add_expense, update_income). Hvis databasen er nede eller der opst\u00e5r constraints-fejl, vil serveren returnere en r\u00e5 500-fejl uden forklaring til brugeren.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 388,
      "severity": "error",
      "category": "security",
      "message": "Broken Access Control: 'delete_category' verificerer ikke ejerskab eller rettigheder. Enhver logget ind bruger kan slette kategorier, hvilket potentielt p\u00e5virker alle andre brugere (hvis kategorier er globale).",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 20,
      "severity": "warning",
      "category": "security",
      "message": "PBKDF2-SHA256 iterationer (100.000) er under OWASP anbefalingen p\u00e5 600.000 for at modst\u00e5 brute-force angreb.",
      "auto_fixable": true,
      "fix": {
        "old": "    hashed = hashlib.pbkdf2_hmac('sha256', password.encode(), salt, 100000)",
        "new": "    hashed = hashlib.pbkdf2_hmac('sha256', password.encode(), salt, 600000)"
      },
      "file": "family-budget/src/database.py"
    },
    {
      "line": 133,
      "severity": "warning",
      "category": "performance",
      "message": "get_connection() kalder mkdir() p\u00e5 filsystemet ved hver eneste databaseforesp\u00f8rgsel. Dette b\u00f8r g\u00f8res \u00e9n gang ved initialisering.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 131,
      "severity": "warning",
      "category": "error_handling",
      "message": "Databaseforbindelser i funktioner (f.eks. get_all_income) bruger ikke context managers (with sqlite3.connect...). Hvis en fejl opst\u00e5r f\u00f8r conn.close(), forbliver forbindelsen \u00e5ben.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 165,
      "severity": "warning",
      "category": "bug",
      "message": "update_income bruger et manuelt 'check-then-act' m\u00f8nster (UPDATE + rowcount check + INSERT). Dette er ikke tr\u00e5dsikkert og mindre effektivt end SQLite 'INSERT INTO ... ON CONFLICT'.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 353,
      "severity": "error",
      "category": "bug",
      "message": "Race condition i create_user. En anden proces kan inds\u00e6tte samme brugernavn mellem SELECT og INSERT. Brug en try/except sqlite3.IntegrityError i stedet.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 301,
      "severity": "warning",
      "category": "bug",
      "message": "Logic bug i update_category: Hvis en kategori omd\u00f8bes, opdateres 'expenses' tabellen manuelt baseret p\u00e5 tekst-navne. Da der ikke er en reel Foreign Key p\u00e5 ID-niveau mellem expenses og categories, er data-integriteten skr\u00f8belig.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 434,
      "severity": "warning",
      "category": "style",
      "message": "init_db() k\u00f8res ved import-tid (side-effect). Dette kan skabe problemer under tests eller ved brug af multiple workers (f.eks. Gunicorn). B\u00f8r flyttes til 'if __name__ == \"__main__\":' eller en eksplicit setup-funktion.",
      "auto_fixable": true,
      "fix": {
        "old": "if __name__ != \"__test__\":\n    init_db()",
        "new": "if __name__ == \"__main__\":\n    init_db()"
      },
      "file": "family-budget/src/database.py"
    }
  ]
}