{
  "timestamp": "2026-01-05T02:01:22.468777",
  "project": "family-budget",
  "commit": "02f5225a436ca56b00de430a0de02e0639721420",
  "previous_commit": "151f13d2c8a17c7314555247937223175a450a35",
  "files_reviewed": 3,
  "summary": {
    "total_issues": 17,
    "auto_fixable": 7,
    "by_severity": {
      "error": 7,
      "warning": 6,
      "info": 1
    },
    "by_category": {
      "security": 7,
      "performance": 2,
      "unused": 1,
      "bug": 4,
      "error_handling": 3
    }
  },
  "issues": [
    {
      "line": 9,
      "severity": "warning",
      "category": "security",
      "message": "Inkludering af 'data/' mappen (database directory) i projekt-manifestet \u00f8ger risikoen for at f\u00f8lsomme database-filer ved en fejl inkluderes i versionsstyring eller deployment-pakker.",
      "auto_fixable": false,
      "file": "family-budget/.agent/manifest.yaml"
    },
    {
      "line": 17,
      "severity": "error",
      "category": "security",
      "message": "FastAPI version < 0.109.1 er s\u00e5rbar overfor Denial of Service (ReDoS) via python-multipart. Opdater minimumsversion til 0.109.1.",
      "auto_fixable": true,
      "fix": {
        "old": "  - fastapi>=0.104.0,<1.0.0",
        "new": "  - fastapi>=0.109.1,<1.0.0"
      },
      "file": "family-budget/.agent/manifest.yaml"
    },
    {
      "line": 19,
      "severity": "error",
      "category": "security",
      "message": "Jinja2 version < 3.1.3 er s\u00e5rbar overfor Cross-Site Scripting (XSS) (CVE-2024-22195).",
      "auto_fixable": true,
      "fix": {
        "old": "  - jinja2>=3.1.0,<4.0.0",
        "new": "  - jinja2>=3.1.3,<4.0.0"
      },
      "file": "family-budget/.agent/manifest.yaml"
    },
    {
      "line": 21,
      "severity": "error",
      "category": "security",
      "message": "python-multipart version < 0.0.7 er s\u00e5rbar overfor Regular Expression Denial of Service (ReDoS) (CVE-2024-24762).",
      "auto_fixable": true,
      "fix": {
        "old": "  - python-multipart>=0.0.6,<1.0.0",
        "new": "  - python-multipart>=0.0.7,<1.0.0"
      },
      "file": "family-budget/.agent/manifest.yaml"
    },
    {
      "line": 3,
      "severity": "error",
      "category": "performance",
      "message": "import fcntl er Unix-specifikt og vil f\u00e5 koden til at fejle p\u00e5 Windows-milj\u00f8er.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 9,
      "severity": "info",
      "category": "unused",
      "message": "Ubrugt import: 'wraps' fra functools.",
      "auto_fixable": true,
      "fix": {
        "old": "from functools import wraps",
        "new": ""
      },
      "file": "family-budget/src/api.py"
    },
    {
      "line": 108,
      "severity": "error",
      "category": "bug",
      "message": "SESSIONS indl\u00e6ses kun ved opstart. I et multi-worker milj\u00f8 (uvicorn) vil forskellige processer have usynkroniserede sessions og overskrive hinandens data.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 394,
      "severity": "security",
      "category": "security",
      "message": "add_category mangler tjek for demo_mode. Demo-brugere kan tilf\u00f8je globale kategorier.",
      "auto_fixable": true,
      "fix": {
        "old": "    if not check_auth(request):",
        "new": "    if not check_auth(request):\n        return RedirectResponse(url=\"/budget/login\", status_code=303)\n    if is_demo_mode(request):\n        return RedirectResponse(url=\"/budget/categories\", status_code=303)"
      },
      "file": "family-budget/src/api.py"
    },
    {
      "line": 411,
      "severity": "security",
      "category": "security",
      "message": "edit_category mangler tjek for demo_mode. Demo-brugere kan \u00e6ndre globale kategorier.",
      "auto_fixable": true,
      "fix": {
        "old": "    if not check_auth(request):",
        "new": "    if not check_auth(request):\n        return RedirectResponse(url=\"/budget/login\", status_code=303)\n    if is_demo_mode(request):\n        return RedirectResponse(url=\"/budget/categories\", status_code=303)"
      },
      "file": "family-budget/src/api.py"
    },
    {
      "line": 394,
      "severity": "warning",
      "category": "error_handling",
      "message": "add_category mangler error handling omkring database kaldet.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 411,
      "severity": "warning",
      "category": "error_handling",
      "message": "edit_category mangler error handling omkring database kaldet.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 43,
      "severity": "warning",
      "category": "security",
      "message": "Rate limiting bruger request.client.host direkte. Hvis appen er bag en reverse proxy (f.eks. Nginx), vil alle brugere blive set som samme IP.",
      "auto_fixable": false,
      "file": "family-budget/src/api.py"
    },
    {
      "line": 115,
      "severity": "warning",
      "category": "bug",
      "message": "SQLite foreign key constraints er deaktiveret som standard i SQLite og skal eksplicit aktiveres via PRAGMA for at h\u00e5ndh\u00e6ve dataintegritet.",
      "auto_fixable": true,
      "fix": {
        "old": "    conn = sqlite3.connect(DB_PATH)",
        "new": "    conn = sqlite3.connect(DB_PATH)\n    conn.execute(\"PRAGMA foreign_keys = ON\")"
      },
      "file": "family-budget/src/database.py"
    },
    {
      "line": 128,
      "severity": "error",
      "category": "bug",
      "message": "Tabeller oprettes i forkert r\u00e6kkef\u00f8lge. 'income' og 'expenses' har FOREIGN KEY referencer til 'users', som f\u00f8rst oprettes senere i scriptet. Dette vil fejle ved k\u00f8rsel, hvis foreign keys er aktiveret.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 178,
      "severity": "warning",
      "category": "error_handling",
      "message": "Database connection leak. Hvis en exception opst\u00e5r under SQL-eksekvering, bliver 'conn.close()' aldrig kaldt. Brug try/finally eller en context manager.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 288,
      "severity": "error",
      "category": "bug",
      "message": "Ikke-atomar opdatering. Opdatering af b\u00e5de 'expenses' og 'categories' b\u00f8r ske i en samlet transaktion for at undg\u00e5 inkonsistente data ved fejl midt i processen.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    },
    {
      "line": 292,
      "severity": "performance",
      "category": "performance",
      "message": "'update_category' kalder 'get_category_by_id', som \u00e5bner/lukker sin egen forbindelse, hvorefter metoden selv \u00e5bner/lukker en ny. Dette er ineffektivt og b\u00f8r genbruge samme cursor/forbindelse.",
      "auto_fixable": false,
      "file": "family-budget/src/database.py"
    }
  ]
}